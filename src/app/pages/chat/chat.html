@if (vm$ | async; as vm) {
<div class="page">
  <header>
    <h1 class="title">{{ vm.conversation.title }}</h1>
    <button routerLink="/chats" class="button back-button">All Chats</button>
  </header>

  <main>
    <div class="chat-container">
      <div class="chat">
        @for (message of vm.chatData; track message.id) {
        <div class="message" [class.my-message]="message.senderId === vm.currentUserId">
          <div class="message-header">
            <strong>{{ message.senderName }}</strong>
            @if (message.senderId === vm.currentUserId) {
            <button class="delete" type="button" (click)="deleteMessage(message)">
              <span class="material-symbols-outlined"> delete </span>
            </button>
            }
          </div>
          <p>{{ message.body }}</p>

          @if (message.giphyId) {
          <app-giphy-display [giphyId]="message.giphyId"></app-giphy-display>
          }
        </div>
        } @empty {
        <p class="empty-state">This conversation is empty. Send the first message!</p>
        }
      </div>

      <form class="message-form" [formGroup]="messageForm" (ngSubmit)="onSendMessage()">
        <input formControlName="body" placeholder="Message..." autocomplete="off" />
        <button type="button" (click)="attachRandomGif()">Add Random Gif</button>
        <button type="submit" [disabled]="!messageForm.valid">Send</button>

        @if (attachedGiphyUrl) {
        <div class="gif-preview">
          <img [src]="attachedGiphyUrl" alt="Selected GIF" />
        </div>
        }
      </form>
    </div>

    <!--  -->

    <div class="participants">
      <h3>Participants</h3>
      <ul>
        @for(profile of vm.profiles; track profile['uid']) {
        <li>
          {{ profile['displayName'] }}
          @if(vm.currentUserId === vm.conversation.owner && profile['uid'] !==
          vm.conversation.owner) {
          <button class="remove-btn" (click)="removeParticipant(profile['uid'])">Remove</button>
          }
        </li>
        }
      </ul>

      @if(vm.currentUserId === vm.conversation.owner) {
      <div class="add-participant">
        <h4>Add a user:</h4>
        <select #newUserSelect>
          @for(user of vm.potentialParticipants; track user.uid) {
          <option [value]="user.uid">{{ user.displayName }}</option>
          }
        </select>
        <button (click)="addParticipant(newUserSelect.value)">Add</button>
      </div>
      }
    </div>
  </main>
</div>
}
